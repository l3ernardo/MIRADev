<link href="/css/mirastyle.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="./css/style.css">
<link rel="stylesheet" href="./css/jquery-ui.min.css">
<script src="./js/attachments.js"></script>

<!-- JS and CSS for rich text edit -->
<link rel="stylesheet" type="text/css" href="./css/skin.css">
<!-- Utility Dependencies -->
<script src="./lib/yahoo-dom-event.js"></script>
<script src="./lib/element-min.js"></script>
<!-- Needed for Menus, Buttons and Overlays used in the Toolbar -->
<script src="./lib/container_core-min.js"></script>
<!-- Source file for Rich Text Editor-->
<script src="./lib/simpleeditor-min.js"></script>
<script src="./lib/yui-min.js"></script>
<!-- end rich text -->

<input type="hidden" id="docTitle" value="{{reportingQuarter}}">

<script>
//Load document's name
$('h1#pageTitle').html('<b class="ibm-important">'+$('input#docTitle').val()+"</b> Audit / Review");
</script>
<div class="ibm-container" style="width:80%">
  <p style="text-align:right">
    <span style="color: #5C87C4">Created by</span> {{Log.0.name}} <span style="color: #5C87C4">on</span> {{Log.0.date}} <span style="color: #5C87C4">at</span> {{Log.0.time}}<br>
  </p>
  <form id="internalauditform" class="ibm-column-form" name="form" method="POST" action="/saveinternalaudit">
    <input type="hidden" name="_id" value="{{_id}}">
    <input type="hidden" name="docid" id="docid" value="{{_id}}">
    <input type="hidden" name="editmode" value="{{editmode}}">
    <table id="sample_information" cellspacing="0" cellpadding="0" border="0" width="100%" class="ibm-data-table">
      <caption class="mira-caption"><em>Basics</em></caption>
      <tr>
        <td width="25%">ID:</td><td><b>{{id}}</b></td>
      </tr>
      <tr>
        <td>Audit or Review:</td><td>{{auditOrReview}}</td>
      </tr>
      <tr>
        <td>Status:</td><td>{{status}}</td>
      </tr>
      <tr>
        <td>Relevant Country Process(es):</td><td>{{relevantCountryProcess}}</td>
      </tr>
      <tr>
        <td>Organization:</td><td>{{organization}}</td>
      </tr>
      <tr>
        <td>Location:</td><td>{{location}}</td>
      </tr>
      <tr>
        <td>Location description:</td><td>{{locationDescription}}</td>
      </tr>
      <tr>
        <td>IOT & IMT:</td><td>{{IOTIMT}}</td>
      </tr>
      <tr>
        <td>Planned start date:</td><td>{{plannedStartDate}}</td>
      </tr>
      <tr>
        <td>Added to AQ DB:</td><td>{{addedToAQDB}}</td>
      </tr>
      <tr>
        <td>Rating:</td><td >{{{ratingDisplay rating}}}</td>
      </tr>
      <tr>
        <td>Distribution (to):</td><td>{{distributionTo}}</td>
      </tr>
      <tr>
        <td>Distribution (cc):</td><td>{{distributionCC}}</td>
      </tr>
      <tr>
        <td>Reply required:</td><td>{{replyRequired}}</td>
      </tr>
      <tr>
        <td># Recommendations:</td><td>Total:{{numRecommendationsTotal}}<br/>Open:{{numRecommendationsOpen}}</td>
      </tr>

      {{#if editmode}}
      <tr>
        <td>Comments:</td><td>
          <textarea name="comments">{{comments}}</textarea>
        </td>
      </tr>
      <tr>
        <td>Size:</td><td>
          {{{uniqueSelect "size" sizes "name" "name" size}}}
        </td>
      </tr>
      {{else}}
      <tr>
        <td>Comments:</td><td>{{comments}}</td>
      </tr>
      <tr>
        <td>Size:</td><td>
          {{size}}
        </td>
      </tr>
      {{/if}}


      <!-- NOTES & LINKS SECTION -->
      {{>comments}}
    </table>

    <div class="ibm-buttons-row">
      <p>
        {{#if editmode}}
        <input class="ibm-btn-arrow-pri" type="button" id="btn_save" value="Save"/>
        <span class="ibm-sep">&nbsp;</span>
        <input class="ibm-btn-cancel-sec" type="button" id="btn_cancel" value="Close" />
        {{else}}
        <input class="ibm-btn-arrow-pri" type="button" id="btn_edit" value="Edit"/>
        <span class="ibm-sep">&nbsp;</span>
        <input class="ibm-btn-cancel-sec" type="button" id="btn_cancel" value="Close" />
        {{/if}}
      </p>
    </div>
  </form>
</div>
<script>
$(document).ready(function(){
  //Display notes
  $("#NotesReadOnly").html($("input[name='NotesRO']").val());
  //Setup some private variables
  var Dom = YAHOO.util.Dom,
    Event = YAHOO.util.Event;
  //The SimpleEditor config
  var myConfig = {
    height: '200px',
    width: '100%',
    dompath: true,
    focusAtStart: true
  };
  //Load the SimpleEditor
  myEditor = new YAHOO.widget.SimpleEditor('Notes', myConfig);
  myEditor.render();

  $('#btn_edit').click(function() {
    window.location.href = "internalaudit?id="+$("input[name='_id']").val()+"&edit";
  });
  $('#btn_save').click(function(evt) {
    myEditor.saveHTML();
    var YmyEditor = myEditor.get('element').value;
    $('#Notes').val(YmyEditor);

    $("#internalauditform").submit();
  });
  $('#btn_cancel').click(function() {
    window.location.href = "/assessment?id=";
  })
});

</script>
